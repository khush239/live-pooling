This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
client/
  public/
    vite.svg
  src/
    assets/
      react.svg
    components/
      KickedScreen.tsx
      Onboarding.tsx
      SidePanel.tsx
      StudentDashboard.tsx
      TeacherDashboard.tsx
    hooks/
      usePollTimer.ts
      useSocket.ts
    App.css
    App.tsx
    index.css
    main.tsx
  .gitignore
  eslint.config.js
  index.html
  package.json
  README.md
  tsconfig.app.json
  tsconfig.json
  tsconfig.node.json
  vite.config.ts
server/
  src/
    lib/
      db.ts
    models/
      ChatMessage.ts
      Participant.ts
      Poll.ts
      Vote.ts
    services/
      PollService.ts
    index.ts
  package.json
  tsconfig.json
.gitignore
package.json
README.md
vercel.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="client/public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="client/src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="client/src/components/KickedScreen.tsx">
import React from 'react';
import { Sparkles } from 'lucide-react';

const KickedScreen: React.FC = () => {
    return (
        <div className="onboarding-card">
            <div className="badge">
                <Sparkles size={16} fill="white" />
                Intervue Poll
            </div>
            <h1 style={{ fontSize: '3rem', marginTop: '1rem' }}>You've been Kicked out !</h1>
            <p style={{ maxWidth: '80%', margin: '0 auto 2rem' }}>
                Looks like the teacher had removed you from the poll system. Please Try again sometime.
            </p>
        </div>
    );
};

export default KickedScreen;
</file>

<file path="client/src/components/Onboarding.tsx">
import React, { useState } from 'react';

interface Props {
    onComplete: (name: string, role: 'teacher' | 'student') => void;
}

const Onboarding: React.FC<Props> = ({ onComplete }) => {
    const [step, setStep] = useState(1);
    const [role, setRole] = useState<'teacher' | 'student' | null>(null);
    const [name, setName] = useState('');

    const handleContinue = () => {
        if (step === 1 && role) {
            setStep(2);
        } else if (step === 2 && name.trim()) {
            onComplete(name, role!);
        }
    };

    return (
        <div className="onboarding-card">
            <div className="badge">Intervue Poll</div>

            {step === 1 ? (
                <>
                    <h1 className="onboarding-title">Welcome to the <span>Live Polling System</span></h1>
                    <p className="onboarding-subtitle">Please select the role that best describes you to begin using the live polling system</p>

                    <div className="role-selector">
                        <div
                            className={`role-option ${role === 'student' ? 'active' : ''}`}
                            onClick={() => setRole('student')}
                        >
                            <h3 className="role-title">I'm a Student</h3>
                            <p className="role-desc">Lorem Ipsum is simply dummy text of the printing and typesetting industry</p>
                        </div>

                        <div
                            className={`role-option ${role === 'teacher' ? 'active' : ''}`}
                            onClick={() => setRole('teacher')}
                        >
                            <h3 className="role-title">I'm a Teacher</h3>
                            <p className="role-desc">Submit answers and view live poll results in real-time.</p>
                        </div>
                    </div>
                </>
            ) : (
                <>
                    <h1 className="onboarding-title">Let's <span>Get Started</span></h1>
                    <p className="onboarding-subtitle">
                        {role === 'teacher'
                            ? "You'll have the ability to create and manage polls, ask questions, and monitor your students' responses in real-time."
                            : "If you're a student, you'll be able to submit your answers, participate in live polls, and see how your responses compare with your classmates."}
                    </p>

                    <div className="input-group-centered">
                        <label>Enter your Name</label>
                        <input
                            type="text"
                            placeholder="Ex: Rahul Bajaj"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleContinue()}
                            autoFocus
                        />
                    </div>
                </>
            )}

            <button
                className="btn-primary"
                onClick={handleContinue}
                disabled={step === 1 ? !role : !name.trim()}
            >
                Continue
            </button>
        </div>
    );
};

export default Onboarding;
</file>

<file path="client/src/hooks/usePollTimer.ts">
import { useState, useEffect } from 'react';

export const usePollTimer = (initialTime: number | null, onEnd?: () => void) => {
    const [timeLeft, setTimeLeft] = useState<number | null>(initialTime);

    useEffect(() => {
        if (initialTime === null) return;
        setTimeLeft(initialTime);
    }, [initialTime]);

    useEffect(() => {
        if (timeLeft === null || timeLeft <= 0) {
            if (timeLeft === 0 && onEnd) onEnd();
            return;
        }

        const timer = setInterval(() => {
            setTimeLeft(prev => {
                if (prev === null || prev <= 1) {
                    clearInterval(timer);
                    if (onEnd) onEnd();
                    return 0;
                }
                return prev - 1;
            });
        }, 1000);

        return () => clearInterval(timer);
    }, [timeLeft, onEnd]);

    return timeLeft;
};
</file>

<file path="client/src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="client/src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="client/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="client/eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="client/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>client</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="client/package.json">
{
  "name": "client",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.5",
    "framer-motion": "^12.34.3",
    "lucide-react": "^0.575.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "socket.io-client": "^4.8.3"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.48.0",
    "vite": "^7.3.1"
  }
}
</file>

<file path="client/README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="client/tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="client/tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="client/tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="client/vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="server/src/lib/db.ts">
import mongoose from 'mongoose';

const MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/polling-system';

if (!MONGODB_URI) {
    throw new Error('Please define the MONGODB_URI environment variable inside .env');
}

/**
 * Global is used here to maintain a cached connection across hot reloads
 * in development and serverless function invocations in production.
 */
let cached = (global as any).mongoose;

if (!cached) {
    cached = (global as any).mongoose = { conn: null, promise: null };
}

async function connectDB() {
    if (cached.conn) {
        return cached.conn;
    }

    if (!cached.promise) {
        const opts = {
            bufferCommands: false,
        };

        cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {
            return mongoose;
        });
    }

    try {
        cached.conn = await cached.promise;
    } catch (e) {
        cached.promise = null;
        throw e;
    }

    return cached.conn;
}

export default connectDB;
</file>

<file path="server/src/models/ChatMessage.ts">
import mongoose from 'mongoose';

const ChatMessageSchema = new mongoose.Schema({
    user: { type: String, required: true },
    text: { type: String, required: true },
    timestamp: { type: Date, default: Date.now }
});

export default mongoose.model('ChatMessage', ChatMessageSchema);
</file>

<file path="server/src/models/Participant.ts">
import mongoose from 'mongoose';

const ParticipantSchema = new mongoose.Schema({
    socketId: { type: String, required: true, unique: true },
    name: { type: String, required: true },
    role: { type: String, required: true },
    lastSeen: { type: Date, default: Date.now }
});

export default mongoose.model('Participant', ParticipantSchema);
</file>

<file path="server/src/models/Poll.ts">
import mongoose, { Schema, Document } from 'mongoose';

export interface IOption {
    id: string;
    text: string;
    isCorrect: boolean;
}

export interface IPoll extends Document {
    question: string;
    options: IOption[];
    duration: number; // in seconds
    isActive: boolean;
    startTime: Date | null;
    endTime: Date | null;
    createdAt: Date;
}

const PollSchema: Schema = new Schema({
    question: { type: String, required: true },
    options: [{
        id: { type: String, required: true },
        text: { type: String, required: true },
        isCorrect: { type: Boolean, required: true }
    }],
    duration: { type: Number, required: true },
    isActive: { type: Boolean, default: true },
    startTime: { type: Date, default: null },
    endTime: { type: Date, default: null },
    createdAt: { type: Date, default: Date.now }
});

export default mongoose.model<IPoll>('Poll', PollSchema);
</file>

<file path="server/src/models/Vote.ts">
import mongoose, { Schema, Document } from 'mongoose';

export interface IVote extends Document {
    pollId: mongoose.Types.ObjectId;
    studentName: string;
    optionId: string;
    createdAt: Date;
}

const VoteSchema: Schema = new Schema({
    pollId: { type: Schema.Types.ObjectId, ref: 'Poll', required: true },
    studentName: { type: String, required: true },
    optionId: { type: String, required: true },
    createdAt: { type: Date, default: Date.now }
});

// Primary key index to prevent multiple votes per student per poll
VoteSchema.index({ pollId: 1, studentName: 1 }, { unique: true });

export default mongoose.model<IVote>('Vote', VoteSchema);
</file>

<file path="server/src/services/PollService.ts">
import Poll, { IPoll } from '../models/Poll';
import Vote from '../models/Vote';

class PollService {
    async createPoll(data: any): Promise<IPoll> {
        // Deactivate any existing active polls
        await Poll.updateMany({ isActive: true }, { isActive: false });

        const startTime = new Date();
        const endTime = new Date(startTime.getTime() + data.duration * 1000);

        const poll = new Poll({
            ...data,
            isActive: true,
            startTime,
            endTime
        });

        return await poll.save();
    }

    async getActivePoll(): Promise<IPoll | null> {
        const now = new Date();
        const poll = await Poll.findOne({
            isActive: true,
            endTime: { $gt: now }
        });

        if (!poll) {
            // Mark all as inactive if time passed
            await Poll.updateMany({ isActive: true, endTime: { $lte: now } }, { isActive: false });
        }

        return poll;
    }

    async getPollHistory(): Promise<any[]> {
        const polls = await Poll.find().sort({ createdAt: -1 });
        const history = await Promise.all(polls.map(async (poll) => {
            const votes = await Vote.find({ pollId: poll._id });
            const stats = poll.options.map(opt => ({
                id: opt.id,
                text: opt.text,
                isCorrect: opt.isCorrect,
                count: votes.filter(v => v.optionId === opt.id).length
            }));
            return {
                ...poll.toObject(),
                totalVotes: votes.length,
                stats
            };
        }));
        return history;
    }

    async submitVote(pollId: string, studentName: string, optionId: string) {
        const poll = await Poll.findById(pollId);
        if (!poll || !poll.isActive) throw new Error('Poll is not active');

        if (new Date() > poll.endTime!) {
            throw new Error('Poll has ended');
        }

        const vote = new Vote({
            pollId,
            studentName,
            optionId
        });

        return await vote.save();
    }
    async getEnrichedPoll(poll: IPoll): Promise<any> {
        const votes = await Vote.find({ pollId: poll._id });
        const stats = poll.options.map(opt => ({
            id: opt.id,
            text: opt.text,
            isCorrect: opt.isCorrect,
            count: votes.filter(v => v.optionId === opt.id).length
        }));

        return {
            ...poll.toObject(),
            totalVotes: votes.length,
            stats
        };
    }
}

export default new PollService();
</file>

<file path="server/package.json">
{
  "name": "server",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "dev": "ts-node-dev --respawn --transpile-only src/index.ts",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "description": "",
  "dependencies": {
    "cors": "^2.8.6",
    "dotenv": "^17.3.1",
    "express": "^5.2.1",
    "mongoose": "^8.23.0",
    "socket.io": "^4.8.3"
  },
  "devDependencies": {
    "@types/cors": "^2.8.19",
    "@types/express": "^5.0.6",
    "@types/node": "^25.3.0",
    "ts-node-dev": "^2.0.0",
    "typescript": "^5.9.3"
  }
}
</file>

<file path="server/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "CommonJS",
    "rootDir": "./src",
    "outDir": "./dist",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "skipLibCheck": true,
    "sourceMap": true,
    "moduleResolution": "node"
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path=".gitignore">
node_modules/
dist/
.env
.DS_Store
*.log
client/node_modules/
server/node_modules/
client/dist/
server/dist/
.env*
! .env.example
</file>

<file path="package.json">
{
    "name": "intervue-monorepo",
    "version": "1.0.0",
    "description": "Full-stack polling system",
    "main": "server/src/index.ts",
    "scripts": {
        "postinstall": "cd client && npm install && cd ../server && npm install",
        "build": "cd client && npm run build && cd ../server && tsc",
        "start": "cd server && node dist/index.js",
        "dev": "concurrently \"cd client && npm run dev\" \"cd server && npm run dev\""
    },
    "devDependencies": {
        "concurrently": "^8.2.2"
    },
    "engines": {
        "node": ">=20"
    }
}
</file>

<file path="vercel.json">
{
    "version": 2,
    "builds": [
        {
            "src": "server/src/index.ts",
            "use": "@vercel/node"
        },
        {
            "src": "client/package.json",
            "use": "@vercel/static-build",
            "config": {
                "distDir": "dist"
            }
        }
    ],
    "rewrites": [
        {
            "source": "/api/(.*)",
            "destination": "server/src/index.ts"
        },
        {
            "source": "/socket.io/(.*)",
            "destination": "server/src/index.ts"
        },
        {
            "source": "/(.*)",
            "destination": "client/$1"
        }
    ]
}
</file>

<file path="client/src/App.tsx">
import React, { useState, useEffect } from 'react';
import Onboarding from './components/Onboarding';
import TeacherDashboard from './components/TeacherDashboard';
import StudentDashboard from './components/StudentDashboard';
import SidePanel from './components/SidePanel';
import KickedScreen from './components/KickedScreen';
import { useSocket } from './hooks/useSocket';

const App: React.FC = () => {
  const [user, setUser] = useState<{ name: string; role: 'teacher' | 'student' } | null>(() => {
    const saved = sessionStorage.getItem('user');
    return saved ? JSON.parse(saved) : null;
  });
  const [isKicked, setIsKicked] = useState(false);

  const { socket, participants } = useSocket(user?.name || '', user?.role || '');

  useEffect(() => {
    if (socket) {
      socket.on('kicked', () => {
        setIsKicked(true);
        sessionStorage.clear();
      });
    }
    return () => {
      socket?.off('kicked');
    };
  }, [socket]);

  const handleOnboarding = (name: string, role: 'teacher' | 'student') => {
    const userData = { name, role };
    setUser(userData);
    sessionStorage.setItem('user', JSON.stringify(userData));
  };

  const [isSidebarOpen, setSidebarOpen] = useState(false);

  if (isKicked) {
    return <KickedScreen />;
  }

  if (!user) {
    return <Onboarding onComplete={handleOnboarding} />;
  }

  return (
    <div className="app-container">
      {user.role === 'teacher' ? (
        <TeacherDashboard
          name={user.name}
          socket={socket}
          participants={participants}
          onToggleSidebar={() => setSidebarOpen(!isSidebarOpen)}
        />
      ) : (
        <StudentDashboard
          name={user.name}
          socket={socket}
          participants={participants}
          onToggleSidebar={() => setSidebarOpen(!isSidebarOpen)}
        />
      )}
      <div
        className={`side-panel-overlay ${isSidebarOpen ? 'open' : ''}`}
        onClick={() => setSidebarOpen(false)}
      />
      <SidePanel
        socket={socket}
        participants={participants}
        userName={user.name}
        isTeacher={user.role === 'teacher'}
        isOpen={isSidebarOpen}
        onClose={() => setSidebarOpen(false)}
      />
    </div>
  );
};

export default App;
</file>

<file path="README.md">
# Live Pooling System üöÄ

A real-time, interactive polling system built for classrooms and live sessions. Teachers can create instant questions, and students can vote and see live-updating visual results.

## ‚ú® Features

- **Teacher Dashboard**: Create polls with multiple options, set timers, and mark correct answers.
- **Student Dashboard**: Real-time voting interface with live visual progress bars.
- **Live Pooling**: Instant percentage updates for all participants as votes are cast.
- **Visual Results**: Beautiful emerald green theme with dynamic bar-fill animations.
- **Participant Management**: Teacher can see active participants and manage the session.
- **Poll History**: View past questions and their final results.

## üõ†Ô∏è Tech Stack

- **Frontend**: React, Vite, Framer Motion, Lucide React, Socket.io-client.
- **Backend**: Node.js, Express, Socket.io.
- **Database**: MongoDB (Mongoose).
- **Styling**: Vanilla CSS with a custom modern design system.

## üöÄ Getting Started

### Prerequisites

- Node.js (v20+)
- MongoDB running locally or a MongoDB URI

### Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/khush239/live-pooling.git
   cd live-pooling
   ```

2. Install dependencies:
   ```bash
   npm install && npm run build
   ```

## üåê Deployment

### Vercel Deployment (Live)

This project is configured for a **"Live" Vercel deployment** using a root `vercel.json`.

1. **Root Directory**: Ensure this is set to the **Project Root** (blank or `.`) in Vercel Settings.
2. **Environment Variables**: Add `MONGODB_URI` (from MongoDB Atlas).
3. **Build Command**: Vercel will automatically use the root `package.json` build scripts.

### Alternative Deployment (Render / Recommended)

For the best experience with persistent WebSockets (instant updates):
1. **New Web Service**: Connect your repo.
2. **Build Command**: `npm install && npm run build`
3. **Start Command**: `npm start`
4. **Environment Variables**: Add `MONGODB_URI` and `NODE_ENV=production`.

## üìÑ License

ISC
</file>

<file path="client/src/components/SidePanel.tsx">
import React, { useState, useEffect, useRef } from 'react';
import { Socket } from 'socket.io-client';
import axios from 'axios';
import { Send, MessageSquare, Users } from 'lucide-react';

interface Props {
    socket: Socket | null;
    participants: any[];
    userName: string;
    isTeacher: boolean;
    isOpen: boolean;
    onClose: () => void;
}

const SidePanel: React.FC<Props> = ({ socket, participants, userName, isTeacher, isOpen, onClose }) => {
    const [activeTab, setActiveTab] = useState<'chat' | 'participants'>('chat');
    const [message, setMessage] = useState('');
    const [chatMessages, setChatMessages] = useState<any[]>([]);
    const messagesEndRef = useRef<HTMLDivElement>(null);

    useEffect(() => {
        if (!socket) return;

        socket.on('chat_history', (history) => setChatMessages(history));
        socket.on('new_message', (msg) => {
            setChatMessages((prev) => [...prev, msg]);
        });

        // Polling fallback for chat history
        const pollChat = async () => {
            if (!socket.connected) {
                try {
                    const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');
                    const res = await axios.get(`${API_URL}/api/chat`);
                    setChatMessages(res.data);
                } catch (e) {
                    console.error('Chat poll failed', e);
                }
            }
        };

        const chatInterval = setInterval(pollChat, 5000);

        return () => {
            socket.off('chat_history');
            socket.off('new_message');
            clearInterval(chatInterval);
        };
    }, [socket]);

    useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
    }, [chatMessages]);

    const sendMessage = async () => {
        if (!message.trim()) return;

        const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');

        if (socket?.connected) {
            socket.emit('send_message', message);
        } else {
            // Fallback to API
            try {
                await axios.post(`${API_URL}/api/chat`, { user: userName, text: message });
            } catch (e) {
                console.error('API Send failed', e);
            }
        }
        setMessage('');
    };

    const handleKick = (id: string) => {
        if (socket) socket.emit('kick_participant', id);
    };

    return (
        <div className={`side-panel ${isOpen ? 'open' : ''}`}>
            <div className="side-panel-header mobile-only">
                <button className="close-side-panel" onClick={onClose}>Close</button>
            </div>
            <div className="side-panel-tabs">
                <button
                    className={activeTab === 'chat' ? 'active' : ''}
                    onClick={() => setActiveTab('chat')}
                    title="Chat"
                >
                    <MessageSquare size={18} />
                </button>
                <button
                    className={activeTab === 'participants' ? 'active' : ''}
                    onClick={() => setActiveTab('participants')}
                    title="Participants"
                >
                    <Users size={18} />
                    <span style={{ fontSize: '0.8rem', marginLeft: '4px' }}>{participants.length}</span>
                </button>
            </div>

            <div className="side-panel-content">
                {activeTab === 'chat' ? (
                    <div className="chat-container">
                        <div className="messages-list">
                            {chatMessages.map((msg) => (
                                <div key={msg.id} className={`msg ${msg.user === userName ? 'own' : 'other'}`}>
                                    <span className="sender">{msg.user}</span>
                                    <p>{msg.text}</p>
                                </div>
                            ))}
                            <div ref={messagesEndRef} />
                        </div>
                        <div className="chat-inputBox">
                            <div className="chat-input">
                                <input
                                    type="text"
                                    placeholder="Type a message..."
                                    value={message}
                                    onChange={(e) => setMessage(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
                                />
                                <button onClick={sendMessage}><Send size={18} /></button>
                            </div>
                        </div>
                    </div>
                ) : (
                    <div className="participants-list">
                        {participants.map((p) => (
                            <div key={p.id} className="participant-item">
                                <span className="participant-name">{p.name} {p.role === 'teacher' ? '(Teacher)' : ''}</span>
                                {isTeacher && p.role !== 'teacher' && (
                                    <button className="kick-btn" onClick={() => handleKick(p.id)}>Kick</button>
                                )}
                            </div>
                        ))}
                    </div>
                )}
            </div>
        </div>
    );
};

export default SidePanel;
</file>

<file path="client/src/hooks/useSocket.ts">
import { useEffect, useRef, useState } from 'react';
import { io, Socket } from 'socket.io-client';
import axios from 'axios';

const SOCKET_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');

export const useSocket = (name: string, role: string) => {
    const socketRef = useRef<Socket | null>(null);
    const [isConnected, setIsConnected] = useState(false);
    const [participants, setParticipants] = useState<any[]>([]);

    useEffect(() => {
        if (!name) return;

        const socket = io(SOCKET_URL, {
            transports: ['polling', 'websocket'], // Prefer polling for serverless/Vercel compatibility
            reconnection: true
        });
        socketRef.current = socket;

        socket.on('connect', () => {
            setIsConnected(true);
            socket.emit('join', { name, role });
        });

        socket.on('participants_update', (data) => {
            setParticipants(data);
        });

        // Heartbeat for serverless environments
        const sendHeartbeat = async () => {
            try {
                const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');
                await axios.post(`${API_URL}/api/participants/heartbeat`, {
                    name,
                    role,
                    socketId: socket.id
                });
            } catch (e) {
                console.error('Heartbeat failed', e);
            }
        };

        // Send initial heartbeat
        sendHeartbeat();

        // Heartbeat interval
        const heartbeatInterval = setInterval(sendHeartbeat, 10000);

        // Polling fallback for participants
        const pollInterval = setInterval(async () => {
            if (!socket.connected) {
                try {
                    const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');
                    const res = await axios.get(`${API_URL}/api/participants`);
                    setParticipants(res.data);
                } catch (e) {
                    console.error('Participant poll failed', e);
                }
            }
        }, 5000);

        return () => {
            clearInterval(heartbeatInterval);
            clearInterval(pollInterval);
            socket.disconnect();
        };
    }, [name, role]);

    return { socket: socketRef.current, isConnected, participants };
};
</file>

<file path="server/src/index.ts">
import express from 'express';
import http from 'http';
import { Server } from 'socket.io';
import mongoose from 'mongoose';
import cors from 'cors';
import dotenv from 'dotenv';
import PollService from './services/PollService';
import Participant from './models/Participant';
import ChatMessage from './models/ChatMessage';
import connectDB from './lib/db';

dotenv.config();

const app = express();
const server = http.createServer(app);
const io = new Server(server, {
    cors: {
        origin: '*',
        methods: ['GET', 'POST']
    }
});

app.use(cors());
app.use(express.json());

// MongoDB Connection management
connectDB();

// State for real-time tracking (Backups for Serverless)
// Note: Memory will be cleared on Vercel, so we use DB as source of truth
let activeInterval: NodeJS.Timeout | null = null;

// Socket.io Logic
io.on('connection', (socket) => {
    console.log('User connected:', socket.id);

    socket.on('join', async (data) => {
        const { name, role } = data;

        // Save participant to DB for cross-instance sync
        await Participant.findOneAndUpdate(
            { socketId: socket.id },
            { name, role, lastSeen: new Date() },
            { upsert: true }
        );

        const allParticipants = await Participant.find();
        io.emit('participants_update', allParticipants);

        // Send chat history from DB
        const history = await ChatMessage.find().sort({ timestamp: -1 }).limit(50);
        socket.emit('chat_history', history.reverse());

        // Sync late-joiners
        const poll = await PollService.getActivePoll();
        if (poll && poll.endTime) {
            const remaining = Math.max(0, Math.floor((poll.endTime.getTime() - new Date().getTime()) / 1000));
            socket.emit('timer_tick', { remaining });
        }
    });

    socket.on('send_message', async (message) => {
        const user = await Participant.findOne({ socketId: socket.id });
        if (user) {
            const chatMsg = new ChatMessage({
                user: user.name,
                text: message,
                timestamp: new Date()
            });
            await chatMsg.save();
            io.emit('new_message', chatMsg);
        }
    });

    socket.on('kick_participant', (id) => {
        const socketToKick = io.sockets.sockets.get(id);
        if (socketToKick) {
            socketToKick.emit('kicked');
            socketToKick.disconnect();
        }
    });

    socket.on('create_poll', async (data) => {
        try {
            const poll = await PollService.createPoll(data);
            const enrichedPoll = await PollService.getEnrichedPoll(poll);
            io.emit('new_poll', enrichedPoll);
        } catch (err) {
            console.error('Error creating poll:', err);
        }
    });

    socket.on('submit_vote', async (data) => {
        try {
            const { pollId, studentName, optionId } = data;
            await PollService.submitVote(pollId, studentName, optionId);

            const poll = await PollService.getActivePoll();
            if (!poll) return;

            const pollStats = await PollService.getEnrichedPoll(poll);
            io.emit('vote_update', pollStats);
        } catch (err: any) {
            socket.emit('error', err.message);
        }
    });

    socket.on('disconnect', async () => {
        await Participant.deleteOne({ socketId: socket.id });
        const allParticipants = await Participant.find();
        io.emit('participants_update', allParticipants);
        console.log('User disconnected');
    });
});

// API Routes
app.get('/api/active-poll', async (req, res) => {
    const poll = await PollService.getActivePoll();
    if (poll) {
        const enriched = await PollService.getEnrichedPoll(poll);
        return res.json(enriched);
    }
    res.json(null);
});

app.get('/api/history', async (req, res) => {
    const history = await PollService.getPollHistory();
    res.json(history);
});

app.get('/api/participants', async (req, res) => {
    // Cleanup old participants (not seen in last 30s)
    const timeout = new Date(Date.now() - 30000);
    await Participant.deleteMany({ lastSeen: { $lt: timeout } });

    const participants = await Participant.find();
    res.json(participants);
});

app.post('/api/participants/heartbeat', async (req, res) => {
    const { name, role, socketId } = req.body;
    if (!name) return res.status(400).json({ error: 'Name is required' });

    await Participant.findOneAndUpdate(
        { name, role }, // Match by user identity
        { socketId: socketId || 'polling', lastSeen: new Date() },
        { upsert: true }
    );
    res.json({ success: true });
});

app.get('/api/chat', async (req, res) => {
    const history = await ChatMessage.find().sort({ timestamp: -1 }).limit(50);
    res.json(history.reverse());
});

app.post('/api/chat', async (req, res) => {
    const { user, text } = req.body;
    const chatMsg = new ChatMessage({ user, text, timestamp: new Date() });
    await chatMsg.save();
    io.emit('new_message', chatMsg);
    res.json(chatMsg);
});

app.post('/api/poll', async (req, res) => {
    try {
        await connectDB();
        const poll = await PollService.createPoll(req.body);
        const enriched = await PollService.getEnrichedPoll(poll);
        io.emit('new_poll', enriched);
        res.json(enriched);
    } catch (err: any) {
        res.status(500).json({ error: err.message });
    }
});

app.post('/api/vote', async (req, res) => {
    try {
        await connectDB();
        const { pollId, studentName, optionId } = req.body;
        await PollService.submitVote(pollId, studentName, optionId);

        const poll = await PollService.getActivePoll();
        if (poll) {
            const pollStats = await PollService.getEnrichedPoll(poll);
            io.emit('vote_update', pollStats);
            return res.json(pollStats);
        }
        res.json({ success: true });
    } catch (err: any) {
        res.status(500).json({ error: err.message });
    }
});

// Serve static files in production
const path = require('path');
if (process.env.NODE_ENV === 'production') {
    app.use(express.static(path.join(__dirname, '../../client/dist')));
    app.get('*', (req, res) => {
        res.sendFile(path.resolve(__dirname, '../../client', 'dist', 'index.html'));
    });
}

const PORT = process.env.PORT || 5000;
server.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});
</file>

<file path="client/src/components/StudentDashboard.tsx">
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Socket } from 'socket.io-client';
import { usePollTimer } from '../hooks/usePollTimer';
import { Clock, MessageSquare, LogOut } from 'lucide-react';

interface Props {
    name: string;
    socket: Socket | null;
    participants: any[];
    onToggleSidebar: () => void;
}

const StudentDashboard: React.FC<Props> = ({ name, socket, participants: _participants, onToggleSidebar }) => {
    const [activePoll, setActivePoll] = useState<any>(null);
    const [selectedOption, setSelectedOption] = useState<string | null>(null);
    const [hasVoted, setHasVoted] = useState(false);
    const [serverTime, setServerTime] = useState<number | null>(null);
    const timeLeft = usePollTimer(serverTime);

    useEffect(() => {
        fetchActivePoll();

        if (socket) {
            socket.on('new_poll', (poll) => {
                setActivePoll(poll);
                setSelectedOption(null);
                setHasVoted(false);
                setServerTime(poll.duration);
            });

            socket.on('timer_tick', (data) => {
                setServerTime(data.remaining);
            });

            socket.on('vote_update', (pollStats) => {
                setActivePoll((prev: any) => {
                    if (prev && String(pollStats._id) === String(prev._id)) {
                        return pollStats;
                    }
                    return prev;
                });
            });

            socket.on('poll_ended', () => {
                setServerTime(0);
            });
        }

        // Polling fallback for active poll
        const activePollInterval = setInterval(() => {
            if (!socket || !socket.connected) {
                fetchActivePoll();
            }
        }, 5000);

        return () => {
            socket?.off('new_poll');
            socket?.off('timer_tick');
            socket?.off('vote_update');
            socket?.off('poll_ended');
            clearInterval(activePollInterval);
        };
    }, [socket]);

    const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');

    const fetchActivePoll = async () => {
        const res = await axios.get(`${API_URL}/api/active-poll`);
        if (res.data) {
            setActivePoll(res.data);
            // Calculate remaining time from server endTime
            const end = new Date(res.data.endTime).getTime();
            const now = new Date().getTime();
            const remaining = Math.max(0, Math.floor((end - now) / 1000));
            setServerTime(remaining);
        }
    };

    const handleVote = async () => {
        if (!selectedOption || !activePoll || hasVoted || timeLeft === 0) return;

        if (socket?.connected) {
            socket.emit('submit_vote', {
                pollId: activePoll._id,
                studentName: name,
                optionId: selectedOption
            });
        } else {
            // Fallback to REST API
            try {
                const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');
                await axios.post(`${API_URL}/api/vote`, {
                    pollId: activePoll._id,
                    studentName: name,
                    optionId: selectedOption
                });
            } catch (err: any) {
                console.error('API Vote failed:', err.message);
                return; // Don't set hasVoted if it failed
            }
        }
        setHasVoted(true);
    };

    if (!activePoll || timeLeft === 0) {
        return (
            <div className="dashboard-container">
                <div className="header">
                    <div className="user-info">
                        <div className="avatar">{name[0].toUpperCase()}</div>
                        <div>
                            <h2>{name}</h2>
                            <p>Student</p>
                        </div>
                    </div>
                    <div className="nav-actions">
                        <button onClick={onToggleSidebar} className="mobile-only chat-toggle"><MessageSquare size={20} /></button>
                        <button onClick={() => { sessionStorage.clear(); window.location.reload(); }} className="logout"><LogOut size={20} /></button>
                    </div>
                </div>
                <div className="poll-area">
                    <div className="wait-container">
                        <div className="loader"></div>
                        <h1>Wait for the teacher to ask questions..</h1>
                        {activePoll && (
                            <div className="final-results">
                                <h3>Last Poll Results</h3>
                                {activePoll.options.map((opt: any) => {
                                    const stats = activePoll.stats?.find((s: any) => s.id === opt.id);
                                    const count = stats?.count || 0;
                                    const total = activePoll.totalVotes || 1;
                                    const percent = Math.round((count / total) * 100) || 0;
                                    return (
                                        <div key={opt.id} className="result-bar">
                                            <span>{opt.text}</span>
                                            <div className="bar"><div style={{ width: `${percent}%` }}></div></div>
                                            <span>{percent}%</span>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );
    }

    return (
        <div className="dashboard-container">
            <div className="header">
                <div className="user-info">
                    <div className="avatar">{name[0].toUpperCase()}</div>
                    <div>
                        <h2>{name}</h2>
                        <p>Student</p>
                    </div>
                </div>
                <div className="nav-actions">
                    <button onClick={onToggleSidebar} className="mobile-only chat-toggle"><MessageSquare size={20} /></button>
                    <button onClick={() => { sessionStorage.clear(); window.location.reload(); }} className="logout"><LogOut size={20} /></button>
                </div>
            </div>

            <div className="poll-area">
                <div className="student-dashboard">
                    <div className="poll-header">
                        <div className="badge">Active Poll</div>
                        <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>
                            <div className="vote-count" style={{ fontSize: '1.1rem', fontWeight: 700, color: 'var(--text-muted)' }}>
                                {activePoll.totalVotes || 0} votes
                            </div>
                            <div className="timer"><Clock size={16} /> 00:{String(timeLeft).padStart(2, '0')}</div>
                        </div>
                    </div>

                    <div className="question-box">
                        {activePoll.question}
                    </div>

                    <div className="options-grid">
                        {activePoll.options.map((opt: any, idx: number) => {
                            const count = activePoll.stats?.find((s: any) => s.id === opt.id)?.count || 0;
                            const total = activePoll.totalVotes || 0;
                            const percent = total > 0 ? Math.round((count / total) * 100) : 0;
                            return (
                                <div
                                    key={opt.id}
                                    className={`option-card ${selectedOption === opt.id ? 'selected-answer' : ''} ${hasVoted ? 'disabled' : ''}`}
                                    style={{ position: 'relative', overflow: 'hidden' }}
                                    onClick={() => !hasVoted && setSelectedOption(opt.id)}
                                >
                                    {/* Visual Progress Bar */}
                                    {total > 0 && (
                                        <div
                                            className="bar-fill"
                                            style={{
                                                width: `${percent}%`,
                                                position: 'absolute',
                                                left: 0,
                                                top: 0,
                                                bottom: 0,
                                                height: '100%',
                                                zIndex: 0,
                                                opacity: 0.15
                                            }}
                                        ></div>
                                    )}

                                    <div style={{ position: 'relative', zIndex: 1, display: 'flex', alignItems: 'center', width: '100%', gap: '20px' }}>
                                        <span className="idx">{idx + 1}</span>
                                        <span className="text" style={{ flex: 1 }}>{opt.text}</span>
                                        {total > 0 && (
                                            <div className="vote-progress" style={{ position: 'static', marginLeft: 'auto' }}>
                                                {percent}%
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {!hasVoted && (
                        <button
                            className="btn-primary submit-vote"
                            disabled={!selectedOption}
                            onClick={handleVote}
                        >
                            Submit Vote
                        </button>
                    )}
                </div>
            </div>
        </div>
    );
};

export default StudentDashboard;
</file>

<file path="client/src/components/TeacherDashboard.tsx">
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Socket } from 'socket.io-client';
import { Plus, History, LogOut, ChevronDown, MessageSquare } from 'lucide-react';

interface Props {
    name: string;
    socket: Socket | null;
    participants: any[];
    onToggleSidebar: () => void;
}

const TeacherDashboard: React.FC<Props> = ({ name, socket, participants: _participants, onToggleSidebar }) => {
    const [view, setView] = useState<'create' | 'live' | 'history'>('create');
    const [question, setQuestion] = useState('');
    const [options, setOptions] = useState([
        { id: '1', text: '', isCorrect: false },
        { id: '2', text: '', isCorrect: false }
    ]);
    const [duration, setDuration] = useState(60);
    const [activePoll, setActivePoll] = useState<any>(null);
    const [history, setHistory] = useState<any[]>([]);

    useEffect(() => {
        fetchActivePoll();
        fetchHistory();

        if (socket) {
            socket.on('vote_update', (pollStats) => {
                setActivePoll(pollStats);
            });
            socket.on('new_poll', (poll) => {
                setActivePoll(poll);
                setView('live');
            });
            socket.on('poll_ended', () => {
                fetchHistory();
            });
        }

        return () => {
            socket?.off('vote_update');
            socket?.off('new_poll');
            socket?.off('poll_ended');
        };
    }, [socket]);

    const API_URL = import.meta.env.VITE_API_URL || (import.meta.env.PROD ? '' : 'http://localhost:5000');

    const fetchActivePoll = async () => {
        const res = await axios.get(`${API_URL}/api/active-poll`);
        if (res.data) {
            setActivePoll(res.data);
            setView('live');
        }
    };

    const fetchHistory = async () => {
        const res = await axios.get(`${API_URL}/api/history`);
        setHistory(res.data);
    };

    const handleCreatePoll = () => {
        if (!question || options.some(o => !o.text) || !options.some(o => o.isCorrect)) return;
        socket?.emit('create_poll', { question, options, duration });
        setQuestion('');
        setOptions([{ id: '1', text: '', isCorrect: false }, { id: '2', text: '', isCorrect: false }]);
    };

    const addOption = () => {
        setOptions([...options, { id: Date.now().toString(), text: '', isCorrect: false }]);
    };

    return (
        <div className="dashboard-container">
            <div className="header">
                <div className="user-info">
                    <div className="avatar">RB</div>
                    <div>
                        <h2>{name}</h2>
                        <p>Teacher</p>
                    </div>
                </div>
                <div className="nav-actions">
                    <button onClick={onToggleSidebar} className="mobile-only chat-toggle"><MessageSquare size={20} /></button>
                    <button onClick={() => setView('history')} className={view === 'history' ? 'active' : ''}><History size={20} /> <span className="hide-mobile">History</span></button>
                    <button onClick={() => { sessionStorage.clear(); window.location.reload(); }} className="logout"><LogOut size={20} /></button>
                </div>
            </div>

            <div className="poll-area">
                {view === 'create' && (
                    <div className="create-poll">
                        <div className="poll-form-header">
                            <h3>Create New Poll</h3>
                            <div className="duration-select">
                                <span>{duration === 120 ? '2m' : `${duration}s`}</span>
                                <select
                                    value={duration}
                                    onChange={e => setDuration(Number(e.target.value))}
                                    style={{ opacity: 0, position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', cursor: 'pointer', zIndex: 1 }}
                                >
                                    <option value={30}>30 seconds</option>
                                    <option value={60}>60 seconds</option>
                                    <option value={120}>2 minutes</option>
                                </select>
                                <ChevronDown size={18} />
                            </div>
                        </div>

                        <div className="typing-area-container">
                            <textarea
                                placeholder="Ex: Which planet is known as the Red Planet?"
                                value={question}
                                maxLength={100}
                                onChange={e => setQuestion(e.target.value)}
                            />
                            <div className="char-counter">{question.length}/100</div>
                        </div>

                        <div className="options-section">
                            <div className="options-section-header">
                                <div className="left"><h4>Edit Options</h4></div>
                                <div className="right"><h4>Is it Correct?</h4></div>
                            </div>

                            <div className="options-list">
                                {options.map((opt, idx) => (
                                    <div key={opt.id} className="option-row">
                                        <div className="opt-input-wrapper">
                                            <div className="opt-num">{idx + 1}</div>
                                            <input
                                                type="text"
                                                value={opt.text}
                                                placeholder="Option text"
                                                onChange={e => {
                                                    const newOpts = [...options];
                                                    newOpts[idx].text = e.target.value;
                                                    setOptions(newOpts);
                                                }}
                                            />
                                        </div>
                                        <div className="correct-selector">
                                            <div
                                                className={`radio-btn ${opt.isCorrect ? 'active' : ''}`}
                                                onClick={() => {
                                                    const newOpts = options.map((o, i) => ({
                                                        ...o,
                                                        isCorrect: i === idx
                                                    }));
                                                    setOptions(newOpts);
                                                }}
                                            >
                                                <div className="circle"></div>
                                                Yes
                                            </div>
                                            <div
                                                className={`radio-btn ${!opt.isCorrect ? 'active' : ''}`}
                                                onClick={() => {
                                                    const newOpts = [...options];
                                                    newOpts[idx].isCorrect = false;
                                                    setOptions(newOpts);
                                                }}
                                            >
                                                <div className="circle"></div>
                                                No
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={addOption} className="add-more-btn"><Plus size={20} /> Add More option</button>
                            </div>
                        </div>

                        <div className="poll-footer">
                            <button
                                className="ask-btn-large"
                                onClick={handleCreatePoll}
                                disabled={!question || options.some(o => !o.text) || !options.some(o => o.isCorrect)}
                                style={{ opacity: (!question || options.some(o => !o.text) || !options.some(o => o.isCorrect)) ? 0.5 : 1 }}
                            >
                                Ask Question
                            </button>
                        </div>
                    </div>
                )}

                {view === 'live' && activePoll && (
                    <div className="live-results">
                        <h2>Question</h2>
                        <div className="question-box">{activePoll.question}</div>
                        <div className="results-list">
                            {activePoll.options.map((opt: any) => {
                                const stats = activePoll.stats?.find((s: any) => s.id === opt.id);
                                const count = stats?.count || 0;
                                const total = activePoll.totalVotes || 1;
                                const percent = Math.round((count / total) * 100) || 0;

                                return (
                                    <div key={opt.id} className="result-item">
                                        <div className="bar-bg">
                                            <div className="bar-fill" style={{ width: `${percent}%` }}></div>
                                            <span className="opt-text">{opt.text}</span>
                                            <span className="opt-percent">{percent}%</span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div style={{ marginTop: '3rem', display: 'flex', justifyContent: 'center' }}>
                            <button className="ask-btn-large" onClick={() => setView('create')}>+ Ask a new question</button>
                        </div>
                    </div>
                )}

                {view === 'history' && (
                    <div className="history-list">
                        <div className="history-header">
                            <button className="back-btn" onClick={() => setView('create')}>
                                ‚Üê Ask Question
                            </button>
                            <h1>View <span>Poll History</span></h1>
                        </div>
                        {history.map((poll, idx) => (
                            <div key={poll._id} className="history-item">
                                <h3>Question {idx + 1}</h3>
                                <div className="question-box">{poll.question}</div>
                                <div className="results-list">
                                    {poll.stats.map((stat: any) => (
                                        <div key={stat.id} className="result-item mini">
                                            <span className="opt-text">{stat.text}</span>
                                            <span className="opt-count">{stat.count} votes</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        </div>
    );
};

export default TeacherDashboard;
</file>

<file path="client/src/index.css">
:root {
    --primary: #10b981;
    --primary-hover: #059669;
    --bg-light: #ffffff;
    --bg-gray: #f0fdf4;
    --text-main: #111827;
    --text-muted: #6b7280;
    --border: #d1fae5;
    --radius: 12px;
    --success: #10b981;
    --danger: #ef4444;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

html {
    font-size: 14px;
}

@media (min-width: 1440px) {
    html {
        font-size: 16px;
    }
}

/* Onboarding */
.onboarding-card {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    border: 1px solid #f3f4f6;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.03);
}

.badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: #f0fdf4;
    color: var(--primary);
    border: 1px solid var(--border);
    border-radius: 30px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 12px;
}

h1 {
    margin-bottom: 8px;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-main);
}

p {
    color: var(--text-muted);
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
    line-height: 1.5;
}

.onboarding-card h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.1;
}

.onboarding-card p {
    color: var(--text-muted);
    font-size: 1rem;
    margin-bottom: 2rem;
    line-height: 1.5;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.role-selector {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
}

@media (min-width: 768px) {
    .role-selector {
        flex-direction: row;
        gap: 1.5rem;
        margin-bottom: 3rem;
    }
}

.role-option {
    flex: 1;
    border: 1px solid #f3f4f6;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
}

.role-option:hover {
    border-color: var(--primary);
    background: #f0fdf4;
}

.role-option.active {
    border-color: var(--primary);
    background: #f0fdf4;
}

.role-title {
    margin-bottom: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
}

.role-desc {
    margin-bottom: 0;
    font-size: 1rem;
    color: var(--text-muted);
    line-height: 1.5;
}

.input-group-centered {
    text-align: left;
    margin: 0 auto 3rem;
    max-width: 500px;
}

.input-group-centered label {
    display: block;
    margin-bottom: 16px;
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--text-main);
}

.input-group-centered input {
    width: 100%;
    padding: 1.25rem 2rem;
    border: 2px solid var(--border);
    border-radius: 16px;
    font-size: 1.25rem;
    outline: none;
    transition: all 0.2s;
}

.input-group-centered input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.05);
}

.input-group {
    text-align: left;
    margin-bottom: 32px;
}

.input-group label {
    display: block;
    margin-bottom: 12px;
    font-weight: 600;
    font-size: 1rem;
    color: var(--text-main);
}

.input-group input {
    width: 100%;
    padding: 16px 20px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius);
    font-size: 1.1rem;
    outline: none;
    transition: all 0.2s;
}

.input-group input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
}

.btn-primary {
    background: var(--primary);
    color: white;
    width: 100%;
    max-width: 280px;
    /* Larger max-width */
    padding: 16px;
    font-weight: 600;
    font-size: 1.1rem;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-primary:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
}

.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.app-container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

@media (min-width: 1024px) {
    .app-container {
        flex-direction: row;
        height: 100vh;
        overflow: hidden;
        background: #f8fafc;
    }
}

.dashboard-container {
    flex: 1;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
}

@media (min-width: 768px) {
    .dashboard-container {
        padding: 24px 48px;
    }
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    width: 100%;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.poll-area {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #f1f5f9;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    position: relative;
    overflow-y: auto;
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    max-height: calc(100vh - 10rem);
}

@media (min-width: 768px) {
    .poll-area {
        padding: 2rem;
    }
}

.create-poll {
    position: relative;
    min-height: 100%;
    padding-bottom: 80px;
    /* Space for the floating button */
}

.create-poll h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    line-height: 1.1;
    font-weight: 800;
}

.create-poll p {
    font-size: 1.1rem;
    margin-bottom: 1.5rem;
    text-align: left;
}

.poll-form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.poll-form-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
}

.duration-select {
    background: #f3f4f6;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    position: relative;
    /* Fixed: Added relative for absolute select child */
}

.typing-area-container {
    position: relative;
    margin-bottom: 1.5rem;
    width: 100%;
}

.typing-area-container textarea {
    width: 100%;
    min-height: 100px;
    background: #f3f4f6;
    border: none;
    border-radius: 16px;
    padding: 1.5rem;
    font-size: 1.2rem;
    font-weight: 500;
    resize: none;
    outline: none;
}

.char-counter {
    position: absolute;
    bottom: 1.5rem;
    right: 2rem;
    font-size: 1.1rem;
    color: var(--text-muted);
    font-weight: 600;
}

.options-section-header {
    display: flex;
    margin-bottom: 1rem;
}

.options-section-header .left {
    flex: 1;
}

.options-section-header .right {
    width: 250px;
}

.options-section-header h4 {
    font-size: 1.1rem;
    font-weight: 700;
}

.option-row {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    margin-bottom: 1rem;
}

.option-row .opt-input-wrapper {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.opt-num {
    width: 44px;
    height: 44px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.option-row input {
    width: 100%;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    font-weight: 500;
    outline: none;
}

.correct-selector {
    width: 250px;
    display: flex;
    gap: 1rem;
}

.radio-btn {
    flex: 1;
    padding: 1rem;
    border-radius: 12px;
    border: 2px solid transparent;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.2s;
}

.radio-btn .circle {
    width: 24px;
    height: 24px;
    border: 2px solid #d1d5db;
    border-radius: 50%;
    position: relative;
}

.radio-btn.active {
    background: #ecfdf5;
    border-color: var(--primary);
    color: var(--primary);
}

.radio-btn.active .circle {
    border-color: var(--primary);
}

.radio-btn.active .circle::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 12px;
    height: 12px;
    background: var(--primary);
    border-radius: 50%;
}

.add-more-btn {
    border: 2.5px solid var(--primary);
    background: white;
    color: var(--primary);
    padding: 1rem 2rem;
    border-radius: 16px;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
}

.add-more-btn:hover {
    background: #ecfdf5;
}

.poll-footer {
    border-top: 2px solid var(--border);
    padding: 2.5rem 0;
    margin-top: 4rem;
    display: flex;
    justify-content: flex-end;
}

.ask-btn-large {
    background: var(--primary);
    color: white;
    border: none;
    padding: 1.5rem 4rem;
    border-radius: 40px;
    font-size: 1.5rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
}

.ask-btn-large:hover {
    transform: translateY(-4px);
    box-shadow: 0 15px 30px rgba(16, 185, 129, 0.3);
}

.chat-window {
    position: fixed;
    bottom: 24px;
    right: 24px;
}

.side-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    max-width: 320px;
    height: 100vh;
    background: white;
    border-left: 1px solid #f1f5f9;
    display: flex;
    flex-direction: column;
    z-index: 1000;
    transform: translateX(100%);
    transition: transform 0.2s ease;
}

@media (min-width: 1024px) {
    .side-panel {
        position: relative;
        transform: translateX(0);
        width: 320px;
        min-width: 320px;
        z-index: 1;
    }
}

.side-panel-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px);
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}

.side-panel-overlay.open {
    opacity: 1;
    pointer-events: auto;
}

.side-panel-tabs {
    display: flex;
    border-bottom: 1px solid #e5e7eb;
}

.side-panel-tabs button {
    flex: 1;
    padding: 16px;
    background: none;
    border: none;
    font-weight: 800;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 1rem;
    /* Balanced tabs */
}

.side-panel-tabs button.active {
    color: var(--primary);
    border-bottom: 3px solid var(--primary);
}

.side-panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
}

/* Chat Styles */
.chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.messages-list {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    /* More gap */
    padding-bottom: 24px;
}

.msg {
    max-width: 90%;
    padding: 16px 20px;
    border-radius: 20px;
    font-size: 1rem;
    /* Standard chat font */
    position: relative;
    line-height: 1.6;
}

.msg.own {
    align-self: flex-end;
    background: var(--primary);
    color: white;
    border-bottom-right-radius: 4px;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
}

.msg.other {
    align-self: flex-start;
    background: #f3f4f6;
    color: var(--text-main);
    border-bottom-left-radius: 4px;
}

.msg .sender {
    font-size: 1.15rem;
    /* Noticeable sender name */
    font-weight: 800;
    margin-bottom: 8px;
    display: block;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.chat-input {
    display: flex;
    gap: 12px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
}

.chat-input input {
    flex: 1;
    padding: 18px 24px;
    border: 1.5px solid var(--border);
    border-radius: 30px;
    outline: none;
    font-size: 1.25rem;
    /* Big chat typing font */
    transition: all 0.2s;
}

.chat-input input:focus {
    border-color: var(--primary);
}

.chat-input button {
    background: var(--primary);
    color: white;
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.chat-input button:hover {
    transform: scale(1.05);
}

/* Participants Styles */
.participants-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.participant-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: #f9fafb;
    border-radius: 16px;
    border: 1px solid transparent;
    transition: all 0.2s;
}

.participant-item:hover {
    border-color: var(--border);
    background: white;
}

.participant-name {
    font-weight: 800;
    font-size: 1.1rem;
    /* Balanced participant name */
    color: var(--text-main);
}

.kick-btn {
    padding: 6px 14px;
    background: #fee2e2;
    color: var(--danger);
    border: none;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
}

.kick-btn:hover {
    background: var(--danger);
    color: white;
}

@media (max-width: 1024px) {
    .side-panel {
        display: none;
    }
}

/* Dashboards and Components */
.question-box {
    background: #374151 !important;
    color: white !important;
    padding: 2.5rem;
    /* Increased padding */
    border-radius: 20px;
    margin: 24px 0;
    font-weight: 600;
    font-size: 1.4rem;
    /* Larger font */
    line-height: 1.4;
}

.option-input {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.option-input span {
    background: #10b981;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.option-input input {
    flex: 1;
}

.correct-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
}

.correct-toggle button {
    padding: 4px 12px;
    border: 1px solid #e5e7eb;
    border-radius: 20px;
    font-size: 12px;
    background: white;
}

.correct-toggle button.yes {
    background: #ecfdf5;
    border-color: #10b981;
    color: #10b981;
}

.add-opt {
    color: #10b981;
    background: none;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 4px;
    border: 1px solid #10b981;
    padding: 8px 16px;
    margin: 16px 0;
    border-radius: 8px;
}

.ask-btn {
    position: absolute;
    bottom: 32px;
    right: 32px;
    width: auto !important;
    z-index: 10;
}

.result-item {
    margin-bottom: 12px;
}

.bar-bg {
    background: #f3f4f6;
    border-radius: 8px;
    position: relative;
    height: 48px;
    display: flex;
    align-items: center;
    padding: 0 16px;
    overflow: hidden;
    width: 100%;
}

.bar-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    background: #10b981;
    opacity: 0.7;
    transition: width 0.5s ease;
}

.opt-text {
    position: relative;
    z-index: 1;
    font-weight: 500;
}

.opt-percent {
    position: absolute;
    right: 16px;
    z-index: 1;
    font-weight: 600;
}

.avatar {
    width: 60px;
    height: 60px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    margin-right: 16px;
    font-size: 1.25rem;
}

.user-info {
    display: flex;
    align-items: center;
}

.nav-actions {
    display: flex;
    gap: 12px;
}

.nav-actions button {
    background: white;
    border: 2px solid #e5e7eb;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
    /* Standard nav buttons */
    font-weight: 700;
    border-radius: 12px;
}

.nav-actions button.active {
    border-color: #10b981;
    color: #10b981;
}

.nav-actions button.logout {
    color: #ef4444;
}

.participants-modal {
    position: fixed;
    top: 100px;
    right: 40px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    width: 250px;
    z-index: 100;
    padding: 16px;
}

.p-item {
    padding: 8px 0;
    border-bottom: 1px solid #f3f4f6;
    font-size: 14px;
}

.history-item {
    border-radius: 20px;
    background: white;
    padding: 32px;
    margin-bottom: 32px;
    border: 1px solid var(--border);
}

.history-item h3 {
    font-size: 1.4rem;
    margin-bottom: 16px;
    color: var(--text-main);
}

/* History Back Button */
.history-header {
    display: flex;
    align-items: center;
    gap: 24px;
    margin-bottom: 2rem;
}

.back-btn {
    background: white;
    border: 2px solid var(--primary);
    color: var(--primary);
    padding: 12px 28px;
    border-radius: 12px;
    font-size: 1.15rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}

.back-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
}

/* Green highlight for selected student answer */
.selected-answer {
    border: 2.5px solid #10b981 !important;
    background: #ecfdf5 !important;
}

.selected-answer .idx {
    background: #10b981 !important;
    color: white;
}

/* Student Dashboard */
.student-dashboard {
    max-width: 900px;
    /* Increased from 600px */
    width: 100%;
    margin: 0 auto;
}

.poll-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.timer {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #ef4444;
    font-weight: 700;
    background: #fee2e2;
    padding: 4px 12px;
    border-radius: 20px;
}

.options-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.option-card {
    background: white;
    border: 1.5px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem 2rem;
    /* More spacious */
    display: flex;
    align-items: center;
    gap: 20px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    font-size: 1.15rem;
    /* Larger font for options */
    font-weight: 500;
}

.option-card .idx {
    width: 32px;
    height: 32px;
    font-size: 0.9rem;
}

.selected .idx {
    background: #10b981;
    color: white;
}

.submit-vote {
    margin-top: 32px;
    width: 150px !important;
    align-self: flex-end;
}

.wait-container {
    text-align: center;
}

.loader {
    width: 48px;
    height: 48px;
    border: 4px solid #e5e7eb;
    border-top-color: #10b981;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 24px;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.fab-chat {
    position: fixed;
    bottom: 32px;
    right: 32px;
    background: #10b981;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 50;
}

.vote-progress {
    position: absolute;
    right: 16px;
    font-weight: 700;
    color: #10b981;
}

.final-results {
    margin-top: 32px;
    text-align: left;
}

.result-bar {
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.result-bar .bar {
    flex: 1;
    height: 12px;
    background: #f3f4f6;
    border-radius: 6px;
    overflow: hidden;
}

.result-bar .bar div {
    height: 100%;
    background: #10b981;
}

/* Responsive Helpers */
.mobile-only {
    display: none !important;
}

.hide-mobile {
    display: flex;
}

@media (max-width: 1024px) {
    .mobile-only {
        display: flex !important;
    }

    .hide-mobile {
        display: none !important;
    }
}

.chat-toggle {
    background: #ecfdf5 !important;
    color: var(--primary) !important;
    border: 1.5px solid var(--primary) !important;
    padding: 8px 12px !important;
    border-radius: 12px !important;
}

.side-panel-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: flex-end;
}

.close-side-panel {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
}

.option-row {
    flex-direction: column;
    align-items: flex-start !important;
    gap: 1rem;
}

@media (min-width: 768px) {
    .option-row {
        flex-direction: row;
        align-items: center !important;
        gap: 2rem;
    }
}

.correct-selector {
    width: 100% !important;
}

@media (min-width: 768px) {
    .correct-selector {
        width: 250px !important;
    }
}

.submit-vote {
    width: 100% !important;
    max-width: none !important;
}

@media (min-width: 768px) {
    .submit-vote {
        width: 15rem !important;
    }
}
</file>

</files>
